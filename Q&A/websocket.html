<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSocket 简介 | Hello 艾瑞巴蒂</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4d1289e.css" as="style"><link rel="preload" href="/assets/js/app.21ea607d.js" as="script"><link rel="preload" href="/assets/js/2.65618a35.js" as="script"><link rel="preload" href="/assets/js/8.16b54568.js" as="script"><link rel="prefetch" href="/assets/js/10.740a830a.js"><link rel="prefetch" href="/assets/js/11.08856fac.js"><link rel="prefetch" href="/assets/js/12.4f050770.js"><link rel="prefetch" href="/assets/js/13.7e5d11ae.js"><link rel="prefetch" href="/assets/js/14.fa1deff1.js"><link rel="prefetch" href="/assets/js/15.07c6f591.js"><link rel="prefetch" href="/assets/js/16.72d65ac7.js"><link rel="prefetch" href="/assets/js/17.94305a1f.js"><link rel="prefetch" href="/assets/js/18.8f238e57.js"><link rel="prefetch" href="/assets/js/19.89ce8980.js"><link rel="prefetch" href="/assets/js/20.f77a17c7.js"><link rel="prefetch" href="/assets/js/3.29145992.js"><link rel="prefetch" href="/assets/js/4.9fe59de7.js"><link rel="prefetch" href="/assets/js/5.154c42bc.js"><link rel="prefetch" href="/assets/js/6.64f3d772.js"><link rel="prefetch" href="/assets/js/7.833c73d3.js"><link rel="prefetch" href="/assets/js/9.f211fa4e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4d1289e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello 艾瑞巴蒂</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/sass/" class="nav-link">Sass</a></div><div class="nav-item"><a href="/wheel/" class="nav-link">wheel</a></div><div class="nav-item"><a href="/Q&amp;A/" class="nav-link router-link-active">Q&amp;A</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/sass/" class="nav-link">Sass</a></div><div class="nav-item"><a href="/wheel/" class="nav-link">wheel</a></div><div class="nav-item"><a href="/Q&amp;A/" class="nav-link router-link-active">Q&amp;A</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Q&amp;A/" class="sidebar-link">大文件上传</a></li><li><a href="/Q&amp;A/websocket.html" class="active sidebar-link">WebSocket 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Q&amp;A/websocket.html#websocket-是什么？" class="sidebar-link">WebSocket 是什么？</a></li><li class="sidebar-sub-header"><a href="/Q&amp;A/websocket.html#使用原生-websocket-了解" class="sidebar-link">使用原生 WebSocket(了解)</a></li><li class="sidebar-sub-header"><a href="/Q&amp;A/websocket.html#socket-io" class="sidebar-link">Socket.io</a></li><li class="sidebar-sub-header"><a href="/Q&amp;A/websocket.html#使用ngrok内网穿透将我们开发的聊天室供给其他人使用" class="sidebar-link">使用ngrok内网穿透将我们开发的聊天室供给其他人使用</a></li></ul></li><li><a href="/Q&amp;A/login.html" class="sidebar-link">登录态失效重新登录成功后跳回之前页面解决方案</a></li><li><a href="/Q&amp;A/skills.html" class="sidebar-link">开发调试技巧归纳</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="websocket-简介"><a href="#websocket-简介" class="header-anchor">#</a> WebSocket 简介</h1> <h2 id="websocket-是什么？"><a href="#websocket-是什么？" class="header-anchor">#</a> WebSocket 是什么？</h2> <p>Websocket 是一种据通信协议，英似于我们常见的 http</p> <p>既然有 http，为啥还要 Websocket</p> <p>http 通信是<strong>单向</strong>的请求+响应</p> <p><strong>没有请求也就没有响应</strong></p> <p>初次接触 Websocket 的人，都会问同样的问题：我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p> <p>答案很简单，因为 HTTP 协议有一个缺陷：<strong>通信只能由客户端发起。</strong></p> <p>岸例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户推送信息。</p> <p>这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻颁。我们只能使用“轮询”：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是聊天室。</p> <p>轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。Websocket 就是这样发明的。</p> <p>Websocket 协议在 2008 年诞生，2011 年成为国际标准。所有浏览器都已经支持了</p> <p>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种</p> <h3 id="简单理解"><a href="#简单理解" class="header-anchor">#</a> 简单理解</h3> <ul><li><p>HTTP 打电话 我说一句，你回一句，没有提问就没有回答。即便对方主动给你说话，你也听不见</p></li> <li><p>WebSocket 双向对话</p></li></ul> <p><img src="/Q&amp;A/WebSocket%E9%80%9A%E4%BF%A1.jpg" alt="WebSocket通信"></p> <h3 id="其他特点"><a href="#其他特点" class="header-anchor">#</a> 其他特点</h3> <ul><li><p>建立在 TCP 协议之上，服务器端的实现比较容易。</p></li> <li><p>与 HTTP 协议有着良好的兼容性。默认端口也是 80 和 443, 并且握手阶段（第 1 次建立连接）采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p></li> <li><p>数据格式比较轻量，性能开销小，通信高效。</p></li> <li><p>可以发送文本，也可以发送二进制数据。</p></li> <li><p>没有同源跨域限制，客户端可以与任意服务器通信。</p></li> <li><p>协议标识符是 ws（如果加密，则为 wss），服务器网址就是 URL。</p></li> <li><p>浏览器专门为 Websocket 通信提供了一个请求对象 Websocket</p></li></ul> <h2 id="使用原生-websocket-了解"><a href="#使用原生-websocket-了解" class="header-anchor">#</a> 使用原生 WebSocket(了解)</h2> <p>浏览器为 HTTP 通信提供了 XMLHttpRequest 对象，同样的也给 WebSocket 提供了通信操作接口：WebSocket</p> <p><strong>通信模型</strong></p> <ul><li>拨号（建立连接）</li> <li>通话（双向通信）</li> <li>结束通话（关闭连接）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 拨打电话建立连接 wss://echo.websocket.org是官方提供的测试接口，你发送什么消息，它就会回给你什么消息</span>
<span class="token keyword">let</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://echo.websocket.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 建立连接成功，触发open事件</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;建立连接成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// send发送消息</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello WebSocket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 接收到对方发送过来的消息触发message事件，通过回调函数的evt.data拿到消息</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收到消息：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>evt<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 不需要通信的时候可以手动关闭连接</span>
  <span class="token comment">// ws.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 点连接点开的时候触发close事件</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;连接已断开&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>浏览器查看 WebSocket 请求</strong></p> <p><img src="/Q&amp;A/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8BWebSocket%E8%AF%B7%E6%B1%82.jpg" alt="WebSocket通信"></p> <h2 id="socket-io"><a href="#socket-io" class="header-anchor">#</a> Socket.io</h2> <p><strong>介绍</strong></p> <ul><li><p>原生的 WebSocket 使用比较麻烦，所以推荐使用一个封装好的解决方案：socket.io</p></li> <li><p>socket.io 提供了服务端+客户端的实现</p></li> <li><p>Socket.io 和 WebSocket 就像 axios 和 XMLHttpRequest 的关系</p></li></ul> <p><strong>基本使用</strong></p> <p>服务端代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;socket.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// app.get(&quot;/&quot;, (req, res) =&gt; res.send(&quot;&lt;p&gt;Hello World&lt;/p&gt;&quot;));</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当客户端与服务端建立WebSocket连接成功会触发 connection事件</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有一个用户连接进来了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 给客户端发送消息</span>
  <span class="token comment">// 参数1: 消息类型 参数2: 消息内容</span>
  socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;toClient&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;toServer&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;disconnect&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有用户离开了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>客户端代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建立连接 默认为当前网页地址连接 也可以指定地址 io('xxxx')</span>
<span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//   接收服务端发送的消息，消息类型要和服务端保持一致</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;toClient&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;toServer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>简易聊天室 Demo 代码</strong></p> <p>服务端代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;socket.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// app.get(&quot;/&quot;, (req, res) =&gt; res.send(&quot;&lt;p&gt;Hello World&lt;/p&gt;&quot;));</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当客户端与服务端建立WebSocket连接成功会触发 connection事件</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有一个用户连接进来了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;chat msg&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// socket.emit 和 io.emit区别是socket.emit是只能发送给当前客户端（单个页面），io.emit类似于广播，其他所有页面，其他浏览器都可以收到消息</span>
    io<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;chat msg&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;disconnect&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有用户离开了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>客户端代码</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Socket.IO chat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">*</span> <span class="token punctuation">{</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">font</span><span class="token punctuation">:</span> 13px Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">form</span> <span class="token punctuation">{</span>
        <span class="token property">background</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
        <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">form input</span> <span class="token punctuation">{</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 0.5%<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">form button</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 9%<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>130<span class="token punctuation">,</span> 224<span class="token punctuation">,</span> 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">#messages</span> <span class="token punctuation">{</span>
        <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">#messages li</span> <span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 5px 10px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">#messages li:nth-child(odd)</span> <span class="token punctuation">{</span>
        <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">[v-cloak]</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-cloak</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>messages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(item,idx) in msgList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 发送消息的表单 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">@submit.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>m<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model.trim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>
          Send
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 展示消息的列表 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/socket.io/socket.io.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue/dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
      let socket = io();
      new Vue({
        el: &quot;#app&quot;,
        data: {
          msg: &quot;&quot;,
          msgList: [], // 消息列表
        },
        computed: {
          isLegal() {
            return !this.msg.length || this.msg.length &gt; 20;
          },
        },
        created() {
          socket.on(&quot;chat msg&quot;, (data) =&gt; {
            this.msgList.unshift(data);
          });
        },
        methods: {
          submit() {
            let message = this.msg;
            if (this.isLegal) return alert(&quot;请输入规范的消息&quot;);
            socket.emit(&quot;chat msg&quot;, message);
            this.msg = &quot;&quot;;
          },
        },
      });
</code></pre></div><p><strong>总结</strong></p> <ul><li><p>核心api socket.emit('消息类型',发送给客户端的消息) socket.on('消息类型',接收服务端发送的消息 =&gt; {})</p></li> <li><p>socket.emit 和 io.emit区别是socket.emit是只能发送给当前客户端（单个页面），io.emit类似于<strong>广播</strong>，其他所有页面，其他浏览器都可以收到消息</p></li> <li><p>io.on(&quot;connection&quot;, socket =&gt; {})客户端与服务端成功建立连接触发connection事件</p></li> <li><p>socket.on(&quot;disconnect&quot;, () =&gt; { console.log(&quot;有用户离开了&quot;)}) 连接断开触发disconnect事件</p></li> <li><p>let socket = io() 与服务端建立连接 默认为当前网页地址连接 也可以指定地址 io('xxxx')</p></li></ul> <h2 id="使用ngrok内网穿透将我们开发的聊天室供给其他人使用"><a href="#使用ngrok内网穿透将我们开发的聊天室供给其他人使用" class="header-anchor">#</a> 使用ngrok内网穿透将我们开发的聊天室供给其他人使用</h2> <p>目前我们开发的聊天室只能在当前局域网（连接了同一个wifi）的网络下使用，那么我们想让其他人也能访问使用该怎么办呢？</p> <p><strong>通常情况下我们会这么做</strong></p> <ul><li>找到一台运行于外网的Web服务器</li> <li>服务器上有网站所需要的环境，否则自行搭建</li> <li>将网站部署到服务器上</li> <li>调试结束后，再将网站从服务器上删除</li></ul> <p>不过这样是不是太麻烦了</p> <p><strong>使用ngrok</strong></p> <ul><li><a href="https://dashboard.ngrok.com/signup" target="_blank" rel="noopener noreferrer">注册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://dashboard.ngrok.com/get-started" target="_blank" rel="noopener noreferrer">下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>解压
解压出来会得到一个可执行程序文件，建议把该程序文件访问用户目录中</li> <li>配置用户凭证 ./ngrok authtoken 用户凭证</li> <li>查看使用帮助 ./ngrok help</li> <li>开启代理指定本地web服务 ngrok http 80 （本地需要有此端口服务才行）</li></ul> <p><strong>$nextTick的理解</strong></p> <ul><li>vue中dom的更新是异步的</li></ul> <p><strong>什么时候需要用到$nextTick?</strong> 当你修改了数据后马上需要操作数据影响的dom</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Q&amp;A/" class="prev router-link-active">大文件上传</a></span> <span class="next"><a href="/Q&amp;A/login.html">登录态失效重新登录成功后跳回之前页面解决方案</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.21ea607d.js" defer></script><script src="/assets/js/2.65618a35.js" defer></script><script src="/assets/js/8.16b54568.js" defer></script>
  </body>
</html>
