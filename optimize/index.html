<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于 Vue 项目构建优化 | Hello 艾瑞巴蒂</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4d1289e.css" as="style"><link rel="preload" href="/assets/js/app.4d2af8dc.js" as="script"><link rel="preload" href="/assets/js/2.65618a35.js" as="script"><link rel="preload" href="/assets/js/19.eb35c370.js" as="script"><link rel="prefetch" href="/assets/js/10.2b2b1bcc.js"><link rel="prefetch" href="/assets/js/11.a920e6fd.js"><link rel="prefetch" href="/assets/js/12.76b518ab.js"><link rel="prefetch" href="/assets/js/13.1209b5d9.js"><link rel="prefetch" href="/assets/js/14.57f675fa.js"><link rel="prefetch" href="/assets/js/15.57a8dbde.js"><link rel="prefetch" href="/assets/js/16.2fb9d621.js"><link rel="prefetch" href="/assets/js/17.9b847a20.js"><link rel="prefetch" href="/assets/js/18.952a441d.js"><link rel="prefetch" href="/assets/js/20.04dc599b.js"><link rel="prefetch" href="/assets/js/21.b47da30a.js"><link rel="prefetch" href="/assets/js/22.7d9f602f.js"><link rel="prefetch" href="/assets/js/23.e96add05.js"><link rel="prefetch" href="/assets/js/24.74d818cd.js"><link rel="prefetch" href="/assets/js/25.d99bd3f2.js"><link rel="prefetch" href="/assets/js/26.6bf91b73.js"><link rel="prefetch" href="/assets/js/27.ebfd6b02.js"><link rel="prefetch" href="/assets/js/28.2d5b03bb.js"><link rel="prefetch" href="/assets/js/29.2a10bac8.js"><link rel="prefetch" href="/assets/js/3.cccc7907.js"><link rel="prefetch" href="/assets/js/4.9fe59de7.js"><link rel="prefetch" href="/assets/js/5.4e14f0c6.js"><link rel="prefetch" href="/assets/js/6.c2e58b43.js"><link rel="prefetch" href="/assets/js/7.dd9652d4.js"><link rel="prefetch" href="/assets/js/8.805c72ed.js"><link rel="prefetch" href="/assets/js/9.825d3980.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4d1289e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello 艾瑞巴蒂</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/wheel/" class="nav-link">轮子</a></div><div class="nav-item"><a href="/Q&amp;A/" class="nav-link">项目总结</a></div><div class="nav-item"><a href="/sass/" class="nav-link">Sass</a></div><div class="nav-item"><a href="/mobile/" class="nav-link">mobile</a></div><div class="nav-item"><a href="/theory/" class="nav-link">深入原理</a></div><div class="nav-item"><a href="/optimize/" class="nav-link router-link-exact-active router-link-active">性能优化</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/wheel/" class="nav-link">轮子</a></div><div class="nav-item"><a href="/Q&amp;A/" class="nav-link">项目总结</a></div><div class="nav-item"><a href="/sass/" class="nav-link">Sass</a></div><div class="nav-item"><a href="/mobile/" class="nav-link">mobile</a></div><div class="nav-item"><a href="/theory/" class="nav-link">深入原理</a></div><div class="nav-item"><a href="/optimize/" class="nav-link router-link-exact-active router-link-active">性能优化</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/optimize/" class="active sidebar-link">基于 Vue 项目构建优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/optimize/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/optimize/#gzip-压缩" class="sidebar-link">Gzip 压缩</a></li><li class="sidebar-sub-header"><a href="/optimize/#路由懒加载" class="sidebar-link">路由懒加载</a></li><li class="sidebar-sub-header"><a href="/optimize/#异步组件" class="sidebar-link">异步组件</a></li><li class="sidebar-sub-header"><a href="/optimize/#prefetch" class="sidebar-link">prefetch</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基于-vue-项目构建优化"><a href="#基于-vue-项目构建优化" class="header-anchor">#</a> 基于 Vue 项目构建优化</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>大多数 Vue 项目都是基于 VueCLI 搭建的，而 VueCLI 的底层建筑是 Webpack。使用 webpack 时，如果不注意性能优化，会产生非常大的性能问题，我们升级 VueCLI 升级到最新稳定版，相当于里面的 webapck 代码也更新了。所以这也是一种优化手段</p> <p><strong>两种分析打包结果方式</strong></p> <ul><li><p>Vue ui 图形化界面的方式就查看打包文件的大小</p></li> <li><p>在 package.json 文件中“build“命令加上--report：</p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token string">&quot;scripts:&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build --report&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>会输出如下打包报告图</strong></p> <p><img src="/optimize/%E6%89%93%E5%8C%85%E7%BB%93%E6%9E%9C.png" alt="打包结果"></p> <h2 id="gzip-压缩"><a href="#gzip-压缩" class="header-anchor">#</a> Gzip 压缩</h2> <p>网站加载的速度很大程度上取决于网站资源文件的大小，减少要传输的文件的大小可以使网站不仅加载更快，而且可以给用户省流量</p> <p><strong>Gzip 是什么？</strong></p> <p>一种文件压缩格式</p> <p><strong>开启 Gzip 有什么好处</strong></p> <p>Gzip 开启以后会将输出到用户浏览器的数据进行压缩处理，这样会减小网络传输的数据量，提高文件传输的速度</p> <p><strong>注意点：</strong> gzip 不一定适用于所有文件的压缩。例如文本文件压缩的非常好，通常会缩小两倍以上。但是诸如 JPEG 或 PNG 文件之类的图像已经按其性质进行了压缩，使用 gzip 压缩很难会有好的压缩效果甚至没有效果</p> <p><strong>如何开启？</strong></p> <p>不同的服务器软件配置不一样，具体由部署项目的人负责，一般在公司为运维或后端开发人员</p> <ul><li>Nginx</li> <li>Tomcat</li> <li>Apache</li> <li>IIS</li> <li>...</li></ul> <p>实际工作中，如果服务器软件没有开启，可以和负责运维部署的同事沟通</p> <p><strong>如何监测内容是否开启了 Gzip 压缩？查看响应头中是否有下面的字段信息</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Content-Encoding: gzip
</code></pre></div><p>前端没有调整配置服务器软件，该怎么测试</p> <p>使用 VueCLI 官方推荐的 serve 命令行工具</p> <p>在本博客 Q&amp;A-&gt;开发调试技巧-&gt;测试打包结果有对这个工具的介绍</p> <div class="language- extra-class"><pre class="language-text"><code>// 使用-u参数禁用Gzip压缩可以查看比较开启与否的差别
serve -s -u ./
</code></pre></div><p><img src="/optimize/%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6Gzip%E5%8E%8B%E7%BC%A91.png" alt="查看Gzip压缩"> <img src="/optimize/%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6Gzip%E5%8E%8B%E7%BC%A92.png" alt="查看Gzip压缩"></p> <h2 id="路由懒加载"><a href="#路由懒加载" class="header-anchor">#</a> 路由懒加载</h2> <p>属于首屏加载优化的一种方案</p> <p>默认情况下所有页面资源都会打包到一起,如果页面过多会导致单个文件过大，使用路由懒加载可以优化这种情况，它的思路是把每个页面的资源都独立的生成一个资源文件，只有当访问到该页面的时候才会去请求加载。</p> <p>如果不使用路由懒加载会一次打包成一整个<strong>app.js</strong>文件，再切换路由不会去加载 js 资源文件了，因为在第一次进入页面时就把其他所有的路由的资源文件都加载到 app.js 文件中了。而使用后切换路由，只有到了指定路由的页面才会加载对应的 js 文件</p> <p>可以在 network 中查看两者的区别</p> <p><strong>生成一个 app.js 文件所有页面资源都在这个 js 文件中，后续切换路由不生成 js 文件（未使用路由懒加载）</strong></p> <p><img src="/optimize/%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD%E5%89%8D.png" alt="使用路由懒加载前"></p> <p><strong>切换路由生成对应路由的 js 文件（使用路由懒加载）</strong></p> <p><img src="/optimize/%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD%E5%90%8E.png" alt="使用路由懒加载后"></p> <h2 id="异步组件"><a href="#异步组件" class="header-anchor">#</a> 异步组件</h2> <p>和路由懒加载一个道理</p> <p>在开发一个大型应用时，随着应用越来越大，我们可能需要将应用分割成小一些的代码块，并且只在需要的时候才从服务器加载一个模块。其实<strong>简单来说，我们设想一个场景</strong>，有一个由收藏，历史，积分组成的 tab 栏，用户进入页面看到的时收藏模块，此时用户未切换 tab 栏去查看历史或积分模块。但是却加载了这两个模块的资源。或者说另一个场景，当我们进入某个页面时，希望可以<strong>优先加载比较重要的模块</strong>，然后再去加载一些例如 tooltips、popover、modal 等组件。</p> <p><strong>伪代码</strong></p> <p>未使用异步组件之前</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> 收藏组件 <span class="token keyword">from</span> <span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> 历史组件 <span class="token keyword">from</span> <span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> 积分组件 <span class="token keyword">from</span> <span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">;</span>

components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  收藏组件<span class="token punctuation">,</span> 历史组件<span class="token punctuation">,</span> 积分组件<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用异步组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>currentTabComponent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">收藏组件</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">历史组件</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">积分组件</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./component/xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

computer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">currentTabComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'收藏组件'</span><span class="token punctuation">,</span><span class="token string">'历史组件'</span><span class="token punctuation">,</span><span class="token string">'积分组件'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为这三个组件是在一个路由下的，所以和路由懒加载没关系，使用上面异步组件的方式，可以实现这样切换到哪个 tab 栏下才会去加载对应组件的资源</p> <p>当然因为是异步加载的，当网络瘫痪（连不上网）或其他特殊情况出现时我们还可以设置出错时显示的错误组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">收藏组件</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  component<span class="token punctuation">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  error<span class="token punctuation">:</span> 加载出错时显示的组件<span class="token punctuation">,</span>
  <span class="token comment">// 异步组件加载时使用的组件</span>
  loading<span class="token punctuation">:</span> LoadingComponent<span class="token punctuation">,</span>
  <span class="token comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span>
  delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token comment">// 如果提供了超时时间且组件加载也超时了，</span>
  <span class="token comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span>
  timeout<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> prefetch</h2> <p>prefetch是一种resource hint,用来告诉浏览器在页面加载完成后，利用空闲时间提前获取用户未来可能会访问的内容</p> <p>默认情况下，一个VueCLI应用会为所有作为async chunk生成的js文件（通过动态import()按需code splitting的产物）自动生成prefetch提示。可以在dist/index.html查看</p> <p><img src="/optimize/prefetch.png" alt="prefetch"></p> <p>如需关闭</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 移除 prefetch 插件</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span>

    <span class="token comment">// 或者修改它的选项</span>
    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fileBlacklist <span class="token operator">=</span> options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fileBlacklist <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fileBlacklist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token regex">/myasyncRoute(.)+?\.js$/</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> options
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用建议</strong></p> <ul><li><p>如果是PC端项目建议默认开启</p></li> <li><p>如果是移动端项目建议关闭，帮用户节省流量</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4d2af8dc.js" defer></script><script src="/assets/js/2.65618a35.js" defer></script><script src="/assets/js/19.eb35c370.js" defer></script>
  </body>
</html>
